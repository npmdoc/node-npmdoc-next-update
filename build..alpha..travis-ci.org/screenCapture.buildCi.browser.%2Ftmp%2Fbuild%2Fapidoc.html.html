<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/bahmutov/next-update">next-update (v1.5.1)</a>
</h1>
<h4>Tests if module's dependencies can be updated to the newer version without breaking the tests</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update">module next-update</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next-update">
            function <span class="apidocSignatureSpan"></span>next-update
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.dependencies">
            function <span class="apidocSignatureSpan">next-update.</span>dependencies
            <span class="apidocSignatureSpan">(options, moduleNames)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.filter_allowed_updates">
            function <span class="apidocSignatureSpan">next-update.</span>filter_allowed_updates
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.get_known_dependencies">
            function <span class="apidocSignatureSpan">next-update.</span>get_known_dependencies
            <span class="apidocSignatureSpan">(packageFilename)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.local_module_version">
            function <span class="apidocSignatureSpan">next-update.</span>local_module_version
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.moduleName">
            function <span class="apidocSignatureSpan">next-update.</span>moduleName
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.module_install">
            function <span class="apidocSignatureSpan">next-update.</span>module_install
            <span class="apidocSignatureSpan">(options, results)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update_as_module">
            function <span class="apidocSignatureSpan">next-update.</span>next_update_as_module
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.print_modules_table">
            function <span class="apidocSignatureSpan">next-update.</span>print_modules_table
            <span class="apidocSignatureSpan">(modules, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report_available">
            function <span class="apidocSignatureSpan">next-update.</span>report_available
            <span class="apidocSignatureSpan">(available, currentVersions, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report_install_command">
            function <span class="apidocSignatureSpan">next-update.</span>report_install_command
            <span class="apidocSignatureSpan">(updates)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.revert">
            function <span class="apidocSignatureSpan">next-update.</span>revert
            <span class="apidocSignatureSpan">(moduleName)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.toString">
            function <span class="apidocSignatureSpan">next-update.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>next_update</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>registry</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>report</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>stats</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.dependencies">module next-update.dependencies</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.dependencies.dependencies">
            function <span class="apidocSignatureSpan">next-update.</span>dependencies
            <span class="apidocSignatureSpan">(options, moduleNames)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.filter_allowed_updates">module next-update.filter_allowed_updates</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.filter_allowed_updates.filter_allowed_updates">
            function <span class="apidocSignatureSpan">next-update.</span>filter_allowed_updates
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.get_known_dependencies">module next-update.get_known_dependencies</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.get_known_dependencies.get_known_dependencies">
            function <span class="apidocSignatureSpan">next-update.</span>get_known_dependencies
            <span class="apidocSignatureSpan">(packageFilename)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.local_module_version">module next-update.local_module_version</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.local_module_version.local_module_version">
            function <span class="apidocSignatureSpan">next-update.</span>local_module_version
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.moduleName">module next-update.moduleName</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.moduleName.moduleName">
            function <span class="apidocSignatureSpan">next-update.</span>moduleName
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.module_install">module next-update.module_install</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.module_install.module_install">
            function <span class="apidocSignatureSpan">next-update.</span>module_install
            <span class="apidocSignatureSpan">(options, results)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.next_update">module next-update.next_update</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.available">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>available
            <span class="apidocSignatureSpan">(moduleName, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.checkAllUpdates">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>checkAllUpdates
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.checkCurrentInstall">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>checkCurrentInstall
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.print_modules_table">module next-update.print_modules_table</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.print_modules_table.print_modules_table">
            function <span class="apidocSignatureSpan">next-update.</span>print_modules_table
            <span class="apidocSignatureSpan">(modules, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.registry">module next-update.registry</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.cleanVersion">
            function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersion
            <span class="apidocSignatureSpan">(version, name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.cleanVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersions
            <span class="apidocSignatureSpan">(nameVersionPairs)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.fetchVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>fetchVersions
            <span class="apidocSignatureSpan">(nameVersion)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.isUrl">
            function <span class="apidocSignatureSpan">next-update.registry.</span>isUrl
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.nextVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>nextVersions
            <span class="apidocSignatureSpan">(options, nameVersionPairs, checkLatestOnly)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.report">module next-update.report</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.report">
            function <span class="apidocSignatureSpan">next-update.</span>report
            <span class="apidocSignatureSpan">(updates, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.reportFailure">
            function <span class="apidocSignatureSpan">next-update.report.</span>reportFailure
            <span class="apidocSignatureSpan">(text, useColors)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.reportSuccess">
            function <span class="apidocSignatureSpan">next-update.report.</span>reportSuccess
            <span class="apidocSignatureSpan">(text, useColors)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.report_available">module next-update.report_available</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report_available.report_available">
            function <span class="apidocSignatureSpan">next-update.</span>report_available
            <span class="apidocSignatureSpan">(available, currentVersions, options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.report_install_command">module next-update.report_install_command</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report_install_command.report_install_command">
            function <span class="apidocSignatureSpan">next-update.</span>report_install_command
            <span class="apidocSignatureSpan">(updates)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.revert">module next-update.revert</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.revert.revert">
            function <span class="apidocSignatureSpan">next-update.</span>revert
            <span class="apidocSignatureSpan">(moduleName)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.stats">module next-update.stats</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.colorProbability">
            function <span class="apidocSignatureSpan">next-update.stats.</span>colorProbability
            <span class="apidocSignatureSpan">(probability, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.getSuccessStats">
            function <span class="apidocSignatureSpan">next-update.stats.</span>getSuccessStats
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.printStats">
            function <span class="apidocSignatureSpan">next-update.stats.</span>printStats
            <span class="apidocSignatureSpan">(options, stats)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.sendUpdateResult">
            function <span class="apidocSignatureSpan">next-update.stats.</span>sendUpdateResult
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">next-update.stats.</span>url</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.toString">module next-update.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.toString.toString">
            function <span class="apidocSignatureSpan">next-update.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update" id="apidoc.module.next-update">module next-update</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.next-update" id="apidoc.element.next-update.next-update">
        function <span class="apidocSignatureSpan"></span>next-update
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function nextUpdateTopLevel(options) {
  options = options || {};
  var opts = {
    names: options.module,
    testCommand: options.test,
    latest: Boolean(options.latest),
    keep: Boolean(options.keep),
    color: Boolean(options.color || options.colors),
    allow: options.allow || options.allowed,
    type: options.type,
    changedLog: options['changed-log']
  };

  var checkUpdates = nextUpdate.checkAllUpdates.bind(null, opts);

  return nextUpdate.checkCurrentInstall(opts)
    .then(checkUpdates);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.dependencies" id="apidoc.element.next-update.dependencies">
        function <span class="apidocSignatureSpan">next-update.</span>dependencies
        <span class="apidocSignatureSpan">(options, moduleNames)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getDependenciesToCheck(options, moduleNames) {
    check.verify.object(options, 'missing options');
    debug('initial module names', moduleNames);
    moduleNames = normalizeModuleNames(moduleNames);
    debug('normalized module names', moduleNames);

    var workingDirectory = process.cwd();

    var packageFilename = path.join(workingDirectory, 'package.json');
    var nameVersionPairs = getKnownDependencies(packageFilename);

    var skipModules = getSkippedModules(packageFilename);
    check.verify.array(skipModules, 'expected list of skipped modules');
    if (skipModules.length) {
        if (!options.tldr) {
            console.log('ignoring the following modules', skipModules.join(', '));
        }
        nameVersionPairs = remove(nameVersionPairs, skipModules);
    }
    printTable(options, nameVersionPairs);

    var toCheck = nameVersionPairs;
    if (moduleNames) {
        debug('matching module names', moduleNames);
        toCheck = nameVersionPairs.filter(function (nameVersion) {
            var name = nameVersion.name;
            return moduleNames.some(function (aModule) {
                var moduleName = nameVersionParser(aModule).name;
                return name === moduleName;
            });
        });
        if (!options.tldr) {
            if (toCheck.length) {
                console.log('only checking modules');
                console.log(toCheck.map(function (m) {
                    return m.name + '@' + m.version;
                }));
            } else {
                console.log('Hmm, no modules to check');
                console.log('from initial list\n' +
                    JSON.stringify(nameVersionPairs, null, 2));
            }
        }
    }
    return toCheck;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.filter_allowed_updates" id="apidoc.element.next-update.filter_allowed_updates">
        function <span class="apidocSignatureSpan">next-update.</span>filter_allowed_updates
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">filter_allowed_updates = function () {
	      return checkPredicates(fn, predicates, arguments)
	    }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.get_known_dependencies" id="apidoc.element.next-update.get_known_dependencies">
        function <span class="apidocSignatureSpan">next-update.</span>get_known_dependencies
        <span class="apidocSignatureSpan">(packageFilename)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getKnownDependencies(packageFilename) {
    check.verify.string(packageFilename, 'missing package filename string');

    var workingPackage = require(packageFilename);

    var dependencies = workingPackage.dependencies || {};
    var devDependencies = workingPackage.devDependencies || {};
    var peerDependencies = workingPackage.peerDependencies || {};

    var all = [].concat(
        format('prod', dependencies),
        format('dev', devDependencies),
        format('peer', peerDependencies)
    );

    var cleaned = cleanVersions(all);
    // console.log('nameVersionPairs', cleaned);
    return cleaned;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.local_module_version" id="apidoc.element.next-update.local_module_version">
        function <span class="apidocSignatureSpan">next-update.</span>local_module_version
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getLocalModuleVersion(name) {
    check.verify.string(name, 'missing name string');

    try {
        var filename = path.join('node_modules', name, 'package.json');
        var contents = fs.readFileSync(filename, 'utf-8');
        var pkg = JSON.parse(contents);
        return pkg.version;
    } catch (error) {
        console.error('could not fetch version for local module', name);
        console.error(error);
        return null;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.moduleName" id="apidoc.element.next-update.moduleName">
        function <span class="apidocSignatureSpan">next-update.</span>moduleName
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function moduleName(str) {
    check.verify.string(str, 'expected string module name');

    if (isScopedName(str)) {
      return parseScopedName(str);
    }

    var parts = str.split('@');
    return {
        name: parts[0],
        version: parts[1]
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.module_install" id="apidoc.element.next-update.module_install">
        function <span class="apidocSignatureSpan">next-update.</span>module_install
        <span class="apidocSignatureSpan">(options, results)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function installModule(options, results) {
    check.verify.object(options, 'missing options');
    check.verify.string(options.name, 'expected module name string');
    check.verify.string(options.version, 'expected version string');

    if (options.keep) {
        console.assert(typeof options.keep === 'boolean', 'invalid keep');
    }
    if (results) {
        check.verify.array(results, 'missing results');
    }

    var cmd = formInstallCommand([[{
        name: options.name,
        version: options.version,
        works: true
    }]]);
    check.verify.unemptyString(cmd, 'could not form install command');
    cmd = cmd.trim();

    var moduleVersion = options.name + '@' + options.version, npm;
    if (options.keep) {
        console.log('  ', cmd);
        var args = cmd.split(' ');
        args.shift();
        args.push('--save-exact');
        npm = spawn(NPM_PATH, args);
    } else {
        if (!options.tldr) {
            console.log('  installing', moduleVersion);
        }
        npm = spawn(NPM_PATH, ['install', moduleVersion]);
    }

    var testOutput = '';
    var testErrors = '';

    npm.stdout.setEncoding('utf-8');
    npm.stderr.setEncoding('utf-8');

    function hasError(str) {
        return /error/i.test(str);
    }

    npm.stdout.on('data', function (data) {
        if (hasError(data)) {
            console.log('stdout:', data);
        }
        testOutput += data;
    });

    npm.stderr.on('data', function (data) {
        if (hasError(data)) {
            console.log('stderr:', data);
        }
        testErrors += data;
    });

    npm.on('error', function (err) {
        console.error('error:', err);
        testErrors += err.toString();
    });

    var deferred = q.defer();
    npm.on('exit', function (code) {
        if (code) {
            console.error('npm returned', code);
            console.error('errors:\n' + testErrors);
            deferred.reject({
                code: code,
                errors: testErrors
            });
        } else {
            if (!options.tldr) {
                console.log(moduleVersion, 'installed successfully');
            }
            deferred.resolve(results);
        }
    });
    return deferred.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.next_update_as_module" id="apidoc.element.next-update.next_update_as_module">
        function <span class="apidocSignatureSpan">next-update.</span>next_update_as_module
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function nextUpdateTopLevel(options) {
  options = options || {};
  var opts = {
    names: options.module,
    testCommand: options.test,
    latest: Boolean(options.latest),
    keep: Boolean(options.keep),
    color: Boolean(options.color || options.colors),
    allow: options.allow || options.allowed,
    type: options.type,
    changedLog: options['changed-log']
  };

  var checkUpdates = nextUpdate.checkAllUpdates.bind(null, opts);

  return nextUpdate.checkCurrentInstall(opts)
    .then(checkUpdates);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.print_modules_table" id="apidoc.element.next-update.print_modules_table">
        function <span class="apidocSignatureSpan">next-update.</span>print_modules_table
        <span class="apidocSignatureSpan">(modules, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function printModulesTable(modules, options) {
    verify.array(modules, 'expect an array of modules');
    var haveStats = modules.some(function (m) {
        return typeof m.stats === 'object';
    });

    var t = new Table();
    modules.forEach(function (info) {
        verify.string(info.name, 'missing module name ' + info);
        verify.string(info.version, 'missing module version ' + info);

        t.cell('package', info.name);
        t.cell('current', info.from);
        t.cell('available', info.version);

        if (haveStats &amp;&amp; info.stats) {
            var stats = info.stats;
            verify.object(stats, 'expected stats object');

            var total = +stats.success + stats.failure;
            var probability = total ? stats.success / total : null;
            var probabilityStr = colorProbability(probability, options);
            t.cell('success %', probabilityStr, markProbability);
            t.cell('successful updates', info.stats.success, Table.Number(0));
            t.cell('failed updates', info.stats.failure, Table.Number(0));
        }
        t.newRow();
    });
    console.log(t.toString());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.report_available" id="apidoc.element.next-update.report_available">
        function <span class="apidocSignatureSpan">next-update.</span>report_available
        <span class="apidocSignatureSpan">(available, currentVersions, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reportAvailable(available, currentVersions, options) {
    la(check.array(available), 'expect an array of info objects', available);

    if (!available.length) {
        console.log('nothing new is available');
        return [];
    }

    log('report available');
    log(available);
    log('current versions');
    log(JSON.stringify(currentVersions));

    la(check.maybe.object(currentVersions),
        'expected current versions as an object, but was', currentVersions);

    function getCurrentVersion(name) {
        la(check.unemptyString(name), 'missing name');
        if (!currentVersions) {
            return;
        }
        if (check.string(currentVersions[name])) {
            return currentVersions[name];
        }
        if (check.object(currentVersions[name])) {
            la(check.string(currentVersions[name].version),
                'missing version for', name, 'in', currentVersions);
            return currentVersions[name].version;
        }
    }

    var chain = q();
    var updateStats = {};

    available.forEach(function (info) {
        la(check.unemptyString(info.name), 'missing module name', info);
        la(check.array(info.versions), 'missing module versions', info);

        var currentVersion = getCurrentVersion(info.name);
        log('version for', info.name, currentVersion);

        if (currentVersion) {
            la(check.unemptyString(currentVersion),
                'missing version', currentVersion, 'for', info.name);
            updateStats[info.name] = {
                name: info.name,
                from: currentVersion
            };
        }

        if (info.versions.length === 1) {
            if (currentVersion) {
                chain = chain.then(function () {
                    return getSuccess({
                        name: info.name,
                        from: currentVersion,
                        to: info.versions[0]
                    }).then(function (stats) {
                        updateStats[info.name] = stats;
                    }).catch(ignore);
                });
            }
        }
    });

    return chain.then(function () {
        var modules = [];

        available.forEach(function (info) {
            la(check.unemptyString(info.name), 'missing module name', info);
            la(check.array(info.versions), 'missing module versions', info);

            var sep = ', ', versions;

            if (info.versions.length &lt; 5) {
                versions = info.versions.join(sep);
            } else {
                versions = info.versions.slice(0, 2)
                    .concat('...')
                    .concat(info.versions.slice(info.versions.length - 2))
                    .join(sep);
            }

            var stats = updateStats[info.name];
            if (!stats) {
                return;
            }
            la(check.object(stats), 'could not get stats for', info.name,
                'all', updateStats, 'available stats', info);
            modules.push({
                name: info.name,
                version: versions,
                from: stats.from,
                stats: stats
            });
        });
        console.log('\navailable updates:');
        if (modules.length) {
            print(modules, options);
            console.log('update stats from', clc.underline(stats.url));
        } else {
            console.log(available);
            console.log('no stats is available yet for these updates');
        }
        return available;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.report_install_command" id="apidoc.element.next-update.report_install_command">
        function <span class="apidocSignatureSpan">next-update.</span>report_install_command
        <span class="apidocSignatureSpan">(updates)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function installCommand(updates) {
    check.verify.array(updates, 'expected array of updates');
    if (!updates.length) {
        return;
    }

    var cmd = '';
    var pkg = loadPackage();
    if (!pkg) {
        // assume all dependencies are normal
        cmd = installCommandType(updates, 'dependencies');
    } else {

        var updatesByDependencyType = splitByType(updates, pkg);
        console.assert(updatesByDependencyType, 'could not split updates by type');

        // console.log(updatesByDependencyType)

        var depCmd = installCommandType(updatesByDependencyType.dependencies, 'dependencies');
        var devCmd = installCommandType(updatesByDependencyType.devDependencies, 'devDependencies');
        var peerCmd = installCommandType(updatesByDependencyType.peerDependencies,
            'peerDependencies');
        if (depCmd) {
            cmd += depCmd + '\n';
        }
        if (devCmd) {
            cmd += devCmd + '\n';
        }
        if (peerCmd) {
            cmd += peerCmd + '\n';
        }
    }
    if (cmd) {
        return cmd;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.revert" id="apidoc.element.next-update.revert">
        function <span class="apidocSignatureSpan">next-update.</span>revert
        <span class="apidocSignatureSpan">(moduleName)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function revert(moduleName) {
    if (moduleName) {
        console.log('reverting module', JSON.stringify(moduleName));
    }

    var toCheck = getDependenciesToCheck({}, moduleName);
    var installPromises = toCheck.map(function (nameVersion) {
        var name = nameVersion[0];
        var version = nameVersion[1];
        return installModule.bind(null, {
            name: name,
            version: version,
            tldr: false
        });
    });
    return installPromises.reduce(q.when, q());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.toString" id="apidoc.element.next-update.toString">
        function <span class="apidocSignatureSpan">next-update.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        console.log('stderr:', data);
    }
    testErrors += data;
});

npm.on('error', function (err) {
    console.error('error:', err);
    testErrors += err.<span class="apidocCodeKeywordSpan">toString</span>();
});

var deferred = q.defer();
npm.on('exit', function (code) {
    if (code) {
        console.error('npm returned', code);
        console.error('errors:\n' + testErrors);
...</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.dependencies" id="apidoc.module.next-update.dependencies">module next-update.dependencies</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.dependencies.dependencies" id="apidoc.element.next-update.dependencies.dependencies">
        function <span class="apidocSignatureSpan">next-update.</span>dependencies
        <span class="apidocSignatureSpan">(options, moduleNames)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getDependenciesToCheck(options, moduleNames) {
    check.verify.object(options, 'missing options');
    debug('initial module names', moduleNames);
    moduleNames = normalizeModuleNames(moduleNames);
    debug('normalized module names', moduleNames);

    var workingDirectory = process.cwd();

    var packageFilename = path.join(workingDirectory, 'package.json');
    var nameVersionPairs = getKnownDependencies(packageFilename);

    var skipModules = getSkippedModules(packageFilename);
    check.verify.array(skipModules, 'expected list of skipped modules');
    if (skipModules.length) {
        if (!options.tldr) {
            console.log('ignoring the following modules', skipModules.join(', '));
        }
        nameVersionPairs = remove(nameVersionPairs, skipModules);
    }
    printTable(options, nameVersionPairs);

    var toCheck = nameVersionPairs;
    if (moduleNames) {
        debug('matching module names', moduleNames);
        toCheck = nameVersionPairs.filter(function (nameVersion) {
            var name = nameVersion.name;
            return moduleNames.some(function (aModule) {
                var moduleName = nameVersionParser(aModule).name;
                return name === moduleName;
            });
        });
        if (!options.tldr) {
            if (toCheck.length) {
                console.log('only checking modules');
                console.log(toCheck.map(function (m) {
                    return m.name + '@' + m.version;
                }));
            } else {
                console.log('Hmm, no modules to check');
                console.log('from initial list\n' +
                    JSON.stringify(nameVersionPairs, null, 2));
            }
        }
    }
    return toCheck;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.filter_allowed_updates" id="apidoc.module.next-update.filter_allowed_updates">module next-update.filter_allowed_updates</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.filter_allowed_updates.filter_allowed_updates" id="apidoc.element.next-update.filter_allowed_updates.filter_allowed_updates">
        function <span class="apidocSignatureSpan">next-update.</span>filter_allowed_updates
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">filter_allowed_updates = function () {
	      return checkPredicates(fn, predicates, arguments)
	    }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.get_known_dependencies" id="apidoc.module.next-update.get_known_dependencies">module next-update.get_known_dependencies</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.get_known_dependencies.get_known_dependencies" id="apidoc.element.next-update.get_known_dependencies.get_known_dependencies">
        function <span class="apidocSignatureSpan">next-update.</span>get_known_dependencies
        <span class="apidocSignatureSpan">(packageFilename)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getKnownDependencies(packageFilename) {
    check.verify.string(packageFilename, 'missing package filename string');

    var workingPackage = require(packageFilename);

    var dependencies = workingPackage.dependencies || {};
    var devDependencies = workingPackage.devDependencies || {};
    var peerDependencies = workingPackage.peerDependencies || {};

    var all = [].concat(
        format('prod', dependencies),
        format('dev', devDependencies),
        format('peer', peerDependencies)
    );

    var cleaned = cleanVersions(all);
    // console.log('nameVersionPairs', cleaned);
    return cleaned;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.local_module_version" id="apidoc.module.next-update.local_module_version">module next-update.local_module_version</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.local_module_version.local_module_version" id="apidoc.element.next-update.local_module_version.local_module_version">
        function <span class="apidocSignatureSpan">next-update.</span>local_module_version
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getLocalModuleVersion(name) {
    check.verify.string(name, 'missing name string');

    try {
        var filename = path.join('node_modules', name, 'package.json');
        var contents = fs.readFileSync(filename, 'utf-8');
        var pkg = JSON.parse(contents);
        return pkg.version;
    } catch (error) {
        console.error('could not fetch version for local module', name);
        console.error(error);
        return null;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.moduleName" id="apidoc.module.next-update.moduleName">module next-update.moduleName</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.moduleName.moduleName" id="apidoc.element.next-update.moduleName.moduleName">
        function <span class="apidocSignatureSpan">next-update.</span>moduleName
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function moduleName(str) {
    check.verify.string(str, 'expected string module name');

    if (isScopedName(str)) {
      return parseScopedName(str);
    }

    var parts = str.split('@');
    return {
        name: parts[0],
        version: parts[1]
    };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.module_install" id="apidoc.module.next-update.module_install">module next-update.module_install</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.module_install.module_install" id="apidoc.element.next-update.module_install.module_install">
        function <span class="apidocSignatureSpan">next-update.</span>module_install
        <span class="apidocSignatureSpan">(options, results)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function installModule(options, results) {
    check.verify.object(options, 'missing options');
    check.verify.string(options.name, 'expected module name string');
    check.verify.string(options.version, 'expected version string');

    if (options.keep) {
        console.assert(typeof options.keep === 'boolean', 'invalid keep');
    }
    if (results) {
        check.verify.array(results, 'missing results');
    }

    var cmd = formInstallCommand([[{
        name: options.name,
        version: options.version,
        works: true
    }]]);
    check.verify.unemptyString(cmd, 'could not form install command');
    cmd = cmd.trim();

    var moduleVersion = options.name + '@' + options.version, npm;
    if (options.keep) {
        console.log('  ', cmd);
        var args = cmd.split(' ');
        args.shift();
        args.push('--save-exact');
        npm = spawn(NPM_PATH, args);
    } else {
        if (!options.tldr) {
            console.log('  installing', moduleVersion);
        }
        npm = spawn(NPM_PATH, ['install', moduleVersion]);
    }

    var testOutput = '';
    var testErrors = '';

    npm.stdout.setEncoding('utf-8');
    npm.stderr.setEncoding('utf-8');

    function hasError(str) {
        return /error/i.test(str);
    }

    npm.stdout.on('data', function (data) {
        if (hasError(data)) {
            console.log('stdout:', data);
        }
        testOutput += data;
    });

    npm.stderr.on('data', function (data) {
        if (hasError(data)) {
            console.log('stderr:', data);
        }
        testErrors += data;
    });

    npm.on('error', function (err) {
        console.error('error:', err);
        testErrors += err.toString();
    });

    var deferred = q.defer();
    npm.on('exit', function (code) {
        if (code) {
            console.error('npm returned', code);
            console.error('errors:\n' + testErrors);
            deferred.reject({
                code: code,
                errors: testErrors
            });
        } else {
            if (!options.tldr) {
                console.log(moduleVersion, 'installed successfully');
            }
            deferred.resolve(results);
        }
    });
    return deferred.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.next_update" id="apidoc.module.next-update.next_update">module next-update.next_update</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.next_update.available" id="apidoc.element.next-update.next_update.available">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>available
        <span class="apidocSignatureSpan">(moduleName, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function available(moduleName, options) {
    options = options || {};
    var toCheck = getDependenciesToCheck(options, moduleName);
    la(check.array(toCheck), 'expected object of deps to check, was', toCheck);
    var toCheckHash = _.zipObject(
        _.pluck(toCheck, 'name'),
        _.pluck(toCheck, 'version')
    );

    log('need to check these dependencies');
    log(toCheckHash);

    var nextVersionsPromise = nextVersions(options, toCheck);
    return nextVersionsPromise.then(function (info) {
        return reportAvailable(info, toCheckHash, options);
    }, function (error) {
        console.error('Could not fetch available modules\n', error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.next_update.checkAllUpdates" id="apidoc.element.next-update.next_update.checkAllUpdates">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>checkAllUpdates
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkAllUpdates(options) {
    options = options || {};
    var moduleName = options.names;
    var checkLatestOnly = !!options.latest;
    var checkCommand = options.testCommand;
    if (checkCommand) {
        verify.unemptyString(checkCommand, 'invalid test command ' + checkCommand);
    }
    var all = options.all;
    if (all) {
        checkLatestOnly = true;
        console.log('will check only latest versions because testing all');
    }

    if (check.string(moduleName)) {
        moduleName = [moduleName];
    }
    checkLatestOnly = !!checkLatestOnly;
    if (checkCommand) {
        check.verify.string(checkCommand, 'expected string test command');
    }
    var toCheck = getDependenciesToCheck(options, moduleName);
    check.verify.array(toCheck, 'dependencies to check should be an array');

    makeSureValidModule(moduleName, toCheck);

    var testVersionsBound = testVersions.bind(null, {
        modules: toCheck,
        command: checkCommand,
        all: all,
        color: options.color,
        keep: options.keep,
        allowed: options.allow || options.allowed,
        tldr: options.tldr,
        type: options.type
    });

    return isOnline()
        .then(function (online) {
            if (!online) {
                throw new Error('Need to be online to check new modules');
            }
        }).then(function () {
            if (isSingleSpecificVersion(moduleName)) {
                var nv = nameVersionParser(moduleName[0]);
                console.log('checking only specific:', nv.name, nv.version);
                var list = [{
                    name: nv.name,
                    versions: [nv.version]
                }];
                return testVersionsBound(list);
            } else {
                var nextVersionsPromise = nextVersions(options, toCheck, checkLatestOnly);
                return nextVersionsPromise.then(testVersionsBound);
            }
        });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.next_update.checkCurrentInstall" id="apidoc.element.next-update.next_update.checkCurrentInstall">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>checkCurrentInstall
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkCurrentInstall(options) {
    options = options || {};
    var log = options.tldr ? _.noop : boundConsoleLog;
    log('checking if the current state works');

    return cleanDependencies()
        .then(checkDependenciesInstalled)
        .then(function () {
            return runTest(options, options.testCommand)();
        })
        .then(function () {
            console.log('&gt; tests are passing at the start');
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.print_modules_table" id="apidoc.module.next-update.print_modules_table">module next-update.print_modules_table</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.print_modules_table.print_modules_table" id="apidoc.element.next-update.print_modules_table.print_modules_table">
        function <span class="apidocSignatureSpan">next-update.</span>print_modules_table
        <span class="apidocSignatureSpan">(modules, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function printModulesTable(modules, options) {
    verify.array(modules, 'expect an array of modules');
    var haveStats = modules.some(function (m) {
        return typeof m.stats === 'object';
    });

    var t = new Table();
    modules.forEach(function (info) {
        verify.string(info.name, 'missing module name ' + info);
        verify.string(info.version, 'missing module version ' + info);

        t.cell('package', info.name);
        t.cell('current', info.from);
        t.cell('available', info.version);

        if (haveStats &amp;&amp; info.stats) {
            var stats = info.stats;
            verify.object(stats, 'expected stats object');

            var total = +stats.success + stats.failure;
            var probability = total ? stats.success / total : null;
            var probabilityStr = colorProbability(probability, options);
            t.cell('success %', probabilityStr, markProbability);
            t.cell('successful updates', info.stats.success, Table.Number(0));
            t.cell('failed updates', info.stats.failure, Table.Number(0));
        }
        t.newRow();
    });
    console.log(t.toString());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.registry" id="apidoc.module.next-update.registry">module next-update.registry</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.registry.cleanVersion" id="apidoc.element.next-update.registry.cleanVersion">
        function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersion
        <span class="apidocSignatureSpan">(version, name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cleanVersion(version, name) {
    var originalVersion = version;
    verify.unemptyString(version, 'missing version string' + version);
    verify.unemptyString(name, 'missing name string' + name);

    if (isUrl(version)) {
        // version = version.substr(version.indexOf('#') + 1);

        // hmm, because we don't have a way to fetch git tags yet
        // just skip these dependencies
        console.log('Cannot handle git repos, skipping', name, 'at', version);
        return;
    }
    if (version === 'original' ||
        version === 'modified' ||
        version === 'created') {
        return;
    }

    version = version.replace('~', '').replace('^', '');
    var twoDigitVersion = /^\d+\.\d+$/;
    if (twoDigitVersion.test(version)) {
        version += '.0';
    }
    if (version === 'latest' || version === '*') {
        console.log('Module', name, 'uses version', version);
        console.log('It is recommented to list a specific version number');
        version = localVersion(name);
        if (!version) {
            version = '0.0.1';
        }
        console.log('module', name, 'local version', version);
    }
    try {
        version = semver.clean(version);
    } catch (err) {
        console.error('exception when cleaning version', version);
        return;
    }
    if (!version) {
        log('could not clean version ' + originalVersion + ' for ' + name);
        return;
    }
    console.assert(version, 'missing clean version ' + originalVersion + ' for ' + name);
    return version;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.cleanVersions" id="apidoc.element.next-update.registry.cleanVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersions
        <span class="apidocSignatureSpan">(nameVersionPairs)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cleanVersions(nameVersionPairs) {
    check.verify.array(nameVersionPairs, 'expected array');
    var cleaned = nameVersionPairs
        .map(cleanVersionObject)
        .filter(check.object);
    return cleaned;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.fetchVersions" id="apidoc.element.next-update.registry.fetchVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>fetchVersions
        <span class="apidocSignatureSpan">(nameVersion)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fetchVersions(nameVersion) {
    // console.log(nameVersion);
    // TODO use check.schema
    check.verify.object(nameVersion, 'expected name, version object');
    var name = nameVersion.name;
    var version = nameVersion.version;
    check.verify.string(name, 'missing name string');
    check.verify.string(version, 'missing version string');

    var cleanVersionForName = _.partial(cleanVersionFor, name);
    function isLaterVersion(ver) {
        var later = semver.gt(ver, version);
        return later;
    }

    // console.log('fetching versions for', name, 'current version', version);
    var MAX_WAIT_TIMEOUT = 25000;
    var deferred = q.defer();

    function rejectOnTimeout() {
        var msg = 'timed out waiting for NPM for package ' + name +
            ' after ' + MAX_WAIT_TIMEOUT + 'ms';
        console.error(msg);
        deferred.reject(msg);
    }

    function escapeName(str) {
        return str.replace('/', '%2F');
    }

    registryUrl().then(function (npmUrl) {
        log('NPM registry url', npmUrl);
        la(check.webUrl(npmUrl), 'need npm registry url, got', npmUrl);

        npmUrl = npmUrl.replace(/^https:/, 'http:').trim();
        var url = npmUrl + escapeName(name);

        // TODO how to detect if the registry is not responding?

        log('getting url', url);
        request.get(url, onNPMversions);
        var timer = setTimeout(rejectOnTimeout, MAX_WAIT_TIMEOUT);

        function onNPMversions(err, response, body) {
            log('got response for', url);
            clearTimeout(timer);

            if (err) {
                console.error('ERROR when fetching info for package', name);
                deferred.reject(err.message);
                return;
            }

            if (is404(response)) {
                log('404 response for', url);
                deferred.resolve({
                    name: name,
                    versions: []
                });
                return;
            }

            try {
                log('parsing response body');
                var info = JSON.parse(body);
                log('parsed response, error?', info.error);
                if (info.error) {
                    log('error parsing\n' + body + '\n');
                    var str = formNpmErrorMessage(name, info);
                    console.error(str);

                    if (isNotFound(info.error)) {
                        deferred.resolve({
                            name: name,
                            versions: []
                        });
                        return;
                    }

                    deferred.reject(str);
                    return;
                }
                log('extracting versions');
                var versions = extractVersions(info);
                log('versions', versions);

                if (!Array.isArray(versions)) {
                    throw new Error('Could not get versions for ' + name +
                        ' from ' + JSON.stringify(info) +
                        ' response ' + JSON.stringify(response, null, 2));
                }

                var validVersions = versions.filter(cleanVersionForName);
                var newerVersions = validVersions.filter(isLaterVersion);
                log('valid versions', validVersions);
                log('newer versions', newerVersions);

                deferred.resolve({
                    name: name,
                    versions: newerVersions
                });
                return;
            } catch (err) {
                console.error(err);
                deferred.reject('Could not fetch versions for ' + name);
                return;
            }
        }
    });

    return deferred.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.isUrl" id="apidoc.element.next-update.registry.isUrl">
        function <span class="apidocSignatureSpan">next-update.registry.</span>isUrl
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isUrl(str) {
  la(check.string(str), 'expected a string');
  return httpTester.test(str) || gitTester.test(str);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.nextVersions" id="apidoc.element.next-update.registry.nextVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>nextVersions
        <span class="apidocSignatureSpan">(options, nameVersionPairs, checkLatestOnly)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function nextVersions(options, nameVersionPairs, checkLatestOnly) {
    check.verify.object(options, 'expected object with options');
    check.verify.array(nameVersionPairs, 'expected array');
    checkLatestOnly = !!checkLatestOnly;
    nameVersionPairs = cleanVersions(nameVersionPairs);

    var MAX_CHECK_TIMEOUT = 10000;

    if (!options.tldr) {
        console.log('checking NPM registry');
    }
    var fetchPromises = nameVersionPairs.map(fetchVersions);
    var fetchAllPromise = q.all(fetchPromises)
        .timeout(MAX_CHECK_TIMEOUT, 'timed out waiting for NPM');

    return fetchAllPromise.then(function (results) {
        check.verify.array(results, 'expected list of results');
        log('fetch all new version results');
        log(results);

        var available = results.filter(function (nameNewVersions) {
            return nameNewVersions &amp;&amp;
                check.array(nameNewVersions.versions) &amp;&amp;
                nameNewVersions.versions.length;
        });
        if (checkLatestOnly) {
            available = available.map(function (nameVersions) {
                if (nameVersions.versions.length &gt; 1) {
                    nameVersions.versions = nameVersions.versions.slice(-1);
                }
                return nameVersions;
            });
        } else {
            console.log('checking ALL versions');
        }
        return available;
    }, function (error) {
        return q.reject(error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.report" id="apidoc.module.next-update.report">module next-update.report</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.report.report" id="apidoc.element.next-update.report.report">
        function <span class="apidocSignatureSpan">next-update.</span>report
        <span class="apidocSignatureSpan">(updates, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function report(updates, options) {
    options = options || {};
    var useColors = Boolean(options.useColors) &amp;&amp; colorAvailable;
    check.verify.array(updates, 'expected array of updates');
    // sets latest working version for each module too
    var cmd = formInstallCommand(updates);

    console.log('\n&gt; next updates:');
    updates.forEach(function (moduleVersions) {
        reportModule(moduleVersions, useColors);
    });

    var reportChanges = updates.map(function (moduleVersions) {
        return _.partial(printChangedLog, moduleVersions, useColors);
    });

    function printInstallCommand() {
        if (_.isUndefined(cmd)) {
            console.log('&gt; nothing can be updated :(');
        } else {
            if (options.keptUpdates) {
                console.log('&gt; kept working updates');
            } else {
                cmd = cmd.trim();
                var lines = cmd.split('\n').length;
                if (lines === 1) {
                    console.log('&gt; use the following command to install working versions');
                } else {
                    console.log('&gt; use the following commands to install working versions');
                }
                console.log(cmd);
            }
        }
    }

    function printError(err) {
        console.error('Error reporting changes');
        console.error(err.message);
    }
    var start = options.changedLog ?
        reportChanges.reduce(Q.when, Q()).catch(printError) :
        Q();
    return start.then(printInstallCommand);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.report.reportFailure" id="apidoc.element.next-update.report.reportFailure">
        function <span class="apidocSignatureSpan">next-update.report.</span>reportFailure
        <span class="apidocSignatureSpan">(text, useColors)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reportFailure(text, useColors) {
    if (colorAvailable &amp;&amp; useColors) {
        console.log(colors.redBright(text));
    } else {
        console.log('FAIL', text);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.report.reportSuccess" id="apidoc.element.next-update.report.reportSuccess">
        function <span class="apidocSignatureSpan">next-update.report.</span>reportSuccess
        <span class="apidocSignatureSpan">(text, useColors)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reportSuccess(text, useColors) {
    if (colorAvailable &amp;&amp; useColors) {
        console.log(colors.greenBright(text));
    } else {
        console.log('PASS', text);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.report_available" id="apidoc.module.next-update.report_available">module next-update.report_available</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.report_available.report_available" id="apidoc.element.next-update.report_available.report_available">
        function <span class="apidocSignatureSpan">next-update.</span>report_available
        <span class="apidocSignatureSpan">(available, currentVersions, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reportAvailable(available, currentVersions, options) {
    la(check.array(available), 'expect an array of info objects', available);

    if (!available.length) {
        console.log('nothing new is available');
        return [];
    }

    log('report available');
    log(available);
    log('current versions');
    log(JSON.stringify(currentVersions));

    la(check.maybe.object(currentVersions),
        'expected current versions as an object, but was', currentVersions);

    function getCurrentVersion(name) {
        la(check.unemptyString(name), 'missing name');
        if (!currentVersions) {
            return;
        }
        if (check.string(currentVersions[name])) {
            return currentVersions[name];
        }
        if (check.object(currentVersions[name])) {
            la(check.string(currentVersions[name].version),
                'missing version for', name, 'in', currentVersions);
            return currentVersions[name].version;
        }
    }

    var chain = q();
    var updateStats = {};

    available.forEach(function (info) {
        la(check.unemptyString(info.name), 'missing module name', info);
        la(check.array(info.versions), 'missing module versions', info);

        var currentVersion = getCurrentVersion(info.name);
        log('version for', info.name, currentVersion);

        if (currentVersion) {
            la(check.unemptyString(currentVersion),
                'missing version', currentVersion, 'for', info.name);
            updateStats[info.name] = {
                name: info.name,
                from: currentVersion
            };
        }

        if (info.versions.length === 1) {
            if (currentVersion) {
                chain = chain.then(function () {
                    return getSuccess({
                        name: info.name,
                        from: currentVersion,
                        to: info.versions[0]
                    }).then(function (stats) {
                        updateStats[info.name] = stats;
                    }).catch(ignore);
                });
            }
        }
    });

    return chain.then(function () {
        var modules = [];

        available.forEach(function (info) {
            la(check.unemptyString(info.name), 'missing module name', info);
            la(check.array(info.versions), 'missing module versions', info);

            var sep = ', ', versions;

            if (info.versions.length &lt; 5) {
                versions = info.versions.join(sep);
            } else {
                versions = info.versions.slice(0, 2)
                    .concat('...')
                    .concat(info.versions.slice(info.versions.length - 2))
                    .join(sep);
            }

            var stats = updateStats[info.name];
            if (!stats) {
                return;
            }
            la(check.object(stats), 'could not get stats for', info.name,
                'all', updateStats, 'available stats', info);
            modules.push({
                name: info.name,
                version: versions,
                from: stats.from,
                stats: stats
            });
        });
        console.log('\navailable updates:');
        if (modules.length) {
            print(modules, options);
            console.log('update stats from', clc.underline(stats.url));
        } else {
            console.log(available);
            console.log('no stats is available yet for these updates');
        }
        return available;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.report_install_command" id="apidoc.module.next-update.report_install_command">module next-update.report_install_command</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.report_install_command.report_install_command" id="apidoc.element.next-update.report_install_command.report_install_command">
        function <span class="apidocSignatureSpan">next-update.</span>report_install_command
        <span class="apidocSignatureSpan">(updates)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function installCommand(updates) {
    check.verify.array(updates, 'expected array of updates');
    if (!updates.length) {
        return;
    }

    var cmd = '';
    var pkg = loadPackage();
    if (!pkg) {
        // assume all dependencies are normal
        cmd = installCommandType(updates, 'dependencies');
    } else {

        var updatesByDependencyType = splitByType(updates, pkg);
        console.assert(updatesByDependencyType, 'could not split updates by type');

        // console.log(updatesByDependencyType)

        var depCmd = installCommandType(updatesByDependencyType.dependencies, 'dependencies');
        var devCmd = installCommandType(updatesByDependencyType.devDependencies, 'devDependencies');
        var peerCmd = installCommandType(updatesByDependencyType.peerDependencies,
            'peerDependencies');
        if (depCmd) {
            cmd += depCmd + '\n';
        }
        if (devCmd) {
            cmd += devCmd + '\n';
        }
        if (peerCmd) {
            cmd += peerCmd + '\n';
        }
    }
    if (cmd) {
        return cmd;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.revert" id="apidoc.module.next-update.revert">module next-update.revert</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.revert.revert" id="apidoc.element.next-update.revert.revert">
        function <span class="apidocSignatureSpan">next-update.</span>revert
        <span class="apidocSignatureSpan">(moduleName)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function revert(moduleName) {
    if (moduleName) {
        console.log('reverting module', JSON.stringify(moduleName));
    }

    var toCheck = getDependenciesToCheck({}, moduleName);
    var installPromises = toCheck.map(function (nameVersion) {
        var name = nameVersion[0];
        var version = nameVersion[1];
        return installModule.bind(null, {
            name: name,
            version: version,
            tldr: false
        });
    });
    return installPromises.reduce(q.when, q());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.stats" id="apidoc.module.next-update.stats">module next-update.stats</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.stats.colorProbability" id="apidoc.element.next-update.stats.colorProbability">
        function <span class="apidocSignatureSpan">next-update.stats.</span>colorProbability
        <span class="apidocSignatureSpan">(probability, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function colorProbability(probability, options) {
    if (probability === null) {
        return '';
    }

    options = options || {};
    var useColors = !!options.color &amp;&amp; colorAvailable;
    if (probability &lt; 0 || probability &gt; 1) {
        throw new Error('Expected probability between 0 and 1, not ' + probability);
    }
    var probabilityStr = (probability * 100).toFixed(0) + '%';
    if (useColors) {
        if (probability &gt; 0.8) {
            probabilityStr = colors.greenBright(probabilityStr);
        } else if (probability &gt; 0.5) {
            probabilityStr = colors.yellowBright(probabilityStr);
        } else {
            probabilityStr = colors.redBright(probabilityStr);
        }
    }
    return probabilityStr;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.getSuccessStats" id="apidoc.element.next-update.stats.getSuccessStats">
        function <span class="apidocSignatureSpan">next-update.stats.</span>getSuccessStats
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getSuccessStats(options) {
    verify.unemptyString(options.name, 'missing name');
    verify.unemptyString(options.from, 'missing from version');
    verify.unemptyString(options.to, 'missing to version');

    verify.webUrl(nextUpdateStatsUrl, 'missing next update stats server url');
    var opts = {
        uri: nextUpdateStatsUrl + '/package/' + options.name + '/' + options.from +
            '/' + options.to,
        method: 'GET',
        json: options
    };
    var defer = Q.defer();
    request(opts, function (err, response, stats) {
        if (err || response.statusCode !== 200) {
            if (response) {
                if (response.statusCode !== 404) {
                    console.error('could not get success stats for', options.name);
                    console.error(opts);
                }
                console.error('response status:', response.statusCode);
            }
            if (err) {
                console.error(err);
            }
            defer.reject(err);
            return;
        }
        defer.resolve(stats);
    });
    return defer.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.printStats" id="apidoc.element.next-update.stats.printStats">
        function <span class="apidocSignatureSpan">next-update.stats.</span>printStats
        <span class="apidocSignatureSpan">(options, stats)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function printStats(options, stats) {
    verify.object(stats, 'missing stats object');
    verify.unemptyString(stats.name, 'missing name');
    verify.unemptyString(stats.from, 'missing from version');
    verify.unemptyString(stats.to, 'missing to version');
    stats.success = +stats.success || 0;
    stats.failure = +stats.failure || 0;
    var total = stats.success + stats.failure;
    var probability = (total &gt; 0 ? stats.success / total: 0);
    var probabilityStr = colorProbability(probability, options);
    console.log('stats:', stats.name, stats.from, '-&gt;', stats.to,
        'success probability', probabilityStr,
        stats.success, 'success(es)', stats.failure, 'failure(s)');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.sendUpdateResult" id="apidoc.element.next-update.stats.sendUpdateResult">
        function <span class="apidocSignatureSpan">next-update.stats.</span>sendUpdateResult
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function sendUpdateResult(options) {
    verify.unemptyString(options.name, 'missing name');
    verify.unemptyString(options.from, 'missing from version');
    verify.unemptyString(options.to, 'missing to version');
    if (options.success) {
        options.success = !!options.success;
    }

    verify.webUrl(nextUpdateStatsUrl, 'missing next update stats server url');
    var sendOptions = {
        uri: nextUpdateStatsUrl + '/update',
        method: 'POST',
        json: options
    };
    request(sendOptions, function ignoreResponse() {});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.toString" id="apidoc.module.next-update.toString">module next-update.toString</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.toString.toString" id="apidoc.element.next-update.toString.toString">
        function <span class="apidocSignatureSpan">next-update.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        console.log('stderr:', data);
    }
    testErrors += data;
});

npm.on('error', function (err) {
    console.error('error:', err);
    testErrors += err.<span class="apidocCodeKeywordSpan">toString</span>();
});

var deferred = q.defer();
npm.on('exit', function (code) {
    if (code) {
        console.error('npm returned', code);
        console.error('errors:\n' + testErrors);
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>