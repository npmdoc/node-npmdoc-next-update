<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/bahmutov/next-update">next-update (v1.5.1)</a>
</h1>
<h4>Tests if module's dependencies can be updated to the newer version without breaking the tests</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update">module next-update</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next-update">
            function <span class="apidocSignatureSpan"></span>next-update
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>next_update</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>registry</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>report</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>stats</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.next_update">module next-update.next_update</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.available">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>available
            <span class="apidocSignatureSpan">(moduleName, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.checkAllUpdates">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>checkAllUpdates
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.checkCurrentInstall">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>checkCurrentInstall
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.registry">module next-update.registry</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.cleanVersion">
            function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersion
            <span class="apidocSignatureSpan">(version, name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.cleanVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersions
            <span class="apidocSignatureSpan">(nameVersionPairs)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.fetchVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>fetchVersions
            <span class="apidocSignatureSpan">(nameVersion)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.isUrl">
            function <span class="apidocSignatureSpan">next-update.registry.</span>isUrl
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.nextVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>nextVersions
            <span class="apidocSignatureSpan">(options, nameVersionPairs, checkLatestOnly)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.report">module next-update.report</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.report">
            function <span class="apidocSignatureSpan">next-update.</span>report
            <span class="apidocSignatureSpan">(updates, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.reportFailure">
            function <span class="apidocSignatureSpan">next-update.report.</span>reportFailure
            <span class="apidocSignatureSpan">(text, useColors)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.reportSuccess">
            function <span class="apidocSignatureSpan">next-update.report.</span>reportSuccess
            <span class="apidocSignatureSpan">(text, useColors)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.stats">module next-update.stats</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.colorProbability">
            function <span class="apidocSignatureSpan">next-update.stats.</span>colorProbability
            <span class="apidocSignatureSpan">(probability, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.getSuccessStats">
            function <span class="apidocSignatureSpan">next-update.stats.</span>getSuccessStats
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.printStats">
            function <span class="apidocSignatureSpan">next-update.stats.</span>printStats
            <span class="apidocSignatureSpan">(options, stats)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.sendUpdateResult">
            function <span class="apidocSignatureSpan">next-update.stats.</span>sendUpdateResult
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">next-update.stats.</span>url</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update" id="apidoc.module.next-update">module next-update</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.next-update" id="apidoc.element.next-update.next-update">
        function <span class="apidocSignatureSpan"></span>next-update
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function nextUpdateTopLevel(options) {
  options = options || {};
  var opts = {
    names: options.module,
    testCommand: options.test,
    latest: Boolean(options.latest),
    keep: Boolean(options.keep),
    color: Boolean(options.color || options.colors),
    allow: options.allow || options.allowed,
    type: options.type,
    changedLog: options['changed-log']
  };

  var checkUpdates = nextUpdate.checkAllUpdates.bind(null, opts);

  return nextUpdate.checkCurrentInstall(opts)
    .then(checkUpdates);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.next_update" id="apidoc.module.next-update.next_update">module next-update.next_update</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.next_update.available" id="apidoc.element.next-update.next_update.available">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>available
        <span class="apidocSignatureSpan">(moduleName, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function available(moduleName, options) {
    options = options || {};
    var toCheck = getDependenciesToCheck(options, moduleName);
    la(check.array(toCheck), 'expected object of deps to check, was', toCheck);
    var toCheckHash = _.zipObject(
        _.pluck(toCheck, 'name'),
        _.pluck(toCheck, 'version')
    );

    log('need to check these dependencies');
    log(toCheckHash);

    var nextVersionsPromise = nextVersions(options, toCheck);
    return nextVersionsPromise.then(function (info) {
        return reportAvailable(info, toCheckHash, options);
    }, function (error) {
        console.error('Could not fetch available modules\n', error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var pkg = require('../package.json');
var info = pkg.name + '@' + pkg.version + ' - ' + pkg.description;

var report = require('../src/report').report;
var revert = require('../src/revert');

if (program.available) {
nextUpdate.<span class="apidocCodeKeywordSpan">available</span>(program.module, {
  color: program.color
}).done();
} else if (program.revert) {
revert(program.module)
  .then(function () {
    console.log('done reverting');
  }, function (error) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.next_update.checkAllUpdates" id="apidoc.element.next-update.next_update.checkAllUpdates">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>checkAllUpdates
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkAllUpdates(options) {
    options = options || {};
    var moduleName = options.names;
    var checkLatestOnly = !!options.latest;
    var checkCommand = options.testCommand;
    if (checkCommand) {
        verify.unemptyString(checkCommand, 'invalid test command ' + checkCommand);
    }
    var all = options.all;
    if (all) {
        checkLatestOnly = true;
        console.log('will check only latest versions because testing all');
    }

    if (check.string(moduleName)) {
        moduleName = [moduleName];
    }
    checkLatestOnly = !!checkLatestOnly;
    if (checkCommand) {
        check.verify.string(checkCommand, 'expected string test command');
    }
    var toCheck = getDependenciesToCheck(options, moduleName);
    check.verify.array(toCheck, 'dependencies to check should be an array');

    makeSureValidModule(moduleName, toCheck);

    var testVersionsBound = testVersions.bind(null, {
        modules: toCheck,
        command: checkCommand,
        all: all,
        color: options.color,
        keep: options.keep,
        allowed: options.allow || options.allowed,
        tldr: options.tldr,
        type: options.type
    });

    return isOnline()
        .then(function (online) {
            if (!online) {
                throw new Error('Need to be online to check new modules');
            }
        }).then(function () {
            if (isSingleSpecificVersion(moduleName)) {
                var nv = nameVersionParser(moduleName[0]);
                console.log('checking only specific:', nv.name, nv.version);
                var list = [{
                    name: nv.name,
                    versions: [nv.version]
                }];
                return testVersionsBound(list);
            } else {
                var nextVersionsPromise = nextVersions(options, toCheck, checkLatestOnly);
                return nextVersionsPromise.then(testVersionsBound);
            }
        });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.next_update.checkCurrentInstall" id="apidoc.element.next-update.next_update.checkCurrentInstall">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>checkCurrentInstall
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkCurrentInstall(options) {
    options = options || {};
    var log = options.tldr ? _.noop : boundConsoleLog;
    log('checking if the current state works');

    return cleanDependencies()
        .then(checkDependenciesInstalled)
        .then(function () {
            return runTest(options, options.testCommand)();
        })
        .then(function () {
            console.log('&gt; tests are passing at the start');
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    allow: options.allow || options.allowed,
    type: options.type,
    changedLog: options['changed-log']
  };

  var checkUpdates = nextUpdate.checkAllUpdates.bind(null, opts);

  return nextUpdate.<span class="apidocCodeKeywordSpan">checkCurrentInstall</span>(opts)
    .then(checkUpdates);
};
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.registry" id="apidoc.module.next-update.registry">module next-update.registry</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.registry.cleanVersion" id="apidoc.element.next-update.registry.cleanVersion">
        function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersion
        <span class="apidocSignatureSpan">(version, name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cleanVersion(version, name) {
    var originalVersion = version;
    verify.unemptyString(version, 'missing version string' + version);
    verify.unemptyString(name, 'missing name string' + name);

    if (isUrl(version)) {
        // version = version.substr(version.indexOf('#') + 1);

        // hmm, because we don't have a way to fetch git tags yet
        // just skip these dependencies
        console.log('Cannot handle git repos, skipping', name, 'at', version);
        return;
    }
    if (version === 'original' ||
        version === 'modified' ||
        version === 'created') {
        return;
    }

    version = version.replace('~', '').replace('^', '');
    var twoDigitVersion = /^\d+\.\d+$/;
    if (twoDigitVersion.test(version)) {
        version += '.0';
    }
    if (version === 'latest' || version === '*') {
        console.log('Module', name, 'uses version', version);
        console.log('It is recommented to list a specific version number');
        version = localVersion(name);
        if (!version) {
            version = '0.0.1';
        }
        console.log('module', name, 'local version', version);
    }
    try {
        version = semver.clean(version);
    } catch (err) {
        console.error('exception when cleaning version', version);
        return;
    }
    if (!version) {
        log('could not clean version ' + originalVersion + ' for ' + name);
        return;
    }
    console.assert(version, 'missing clean version ' + originalVersion + ' for ' + name);
    return version;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.cleanVersions" id="apidoc.element.next-update.registry.cleanVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersions
        <span class="apidocSignatureSpan">(nameVersionPairs)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cleanVersions(nameVersionPairs) {
    check.verify.array(nameVersionPairs, 'expected array');
    var cleaned = nameVersionPairs
        .map(cleanVersionObject)
        .filter(check.object);
    return cleaned;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.fetchVersions" id="apidoc.element.next-update.registry.fetchVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>fetchVersions
        <span class="apidocSignatureSpan">(nameVersion)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fetchVersions(nameVersion) {
    // console.log(nameVersion);
    // TODO use check.schema
    check.verify.object(nameVersion, 'expected name, version object');
    var name = nameVersion.name;
    var version = nameVersion.version;
    check.verify.string(name, 'missing name string');
    check.verify.string(version, 'missing version string');

    var cleanVersionForName = _.partial(cleanVersionFor, name);
    function isLaterVersion(ver) {
        var later = semver.gt(ver, version);
        return later;
    }

    // console.log('fetching versions for', name, 'current version', version);
    var MAX_WAIT_TIMEOUT = 25000;
    var deferred = q.defer();

    function rejectOnTimeout() {
        var msg = 'timed out waiting for NPM for package ' + name +
            ' after ' + MAX_WAIT_TIMEOUT + 'ms';
        console.error(msg);
        deferred.reject(msg);
    }

    function escapeName(str) {
        return str.replace('/', '%2F');
    }

    registryUrl().then(function (npmUrl) {
        log('NPM registry url', npmUrl);
        la(check.webUrl(npmUrl), 'need npm registry url, got', npmUrl);

        npmUrl = npmUrl.replace(/^https:/, 'http:').trim();
        var url = npmUrl + escapeName(name);

        // TODO how to detect if the registry is not responding?

        log('getting url', url);
        request.get(url, onNPMversions);
        var timer = setTimeout(rejectOnTimeout, MAX_WAIT_TIMEOUT);

        function onNPMversions(err, response, body) {
            log('got response for', url);
            clearTimeout(timer);

            if (err) {
                console.error('ERROR when fetching info for package', name);
                deferred.reject(err.message);
                return;
            }

            if (is404(response)) {
                log('404 response for', url);
                deferred.resolve({
                    name: name,
                    versions: []
                });
                return;
            }

            try {
                log('parsing response body');
                var info = JSON.parse(body);
                log('parsed response, error?', info.error);
                if (info.error) {
                    log('error parsing\n' + body + '\n');
                    var str = formNpmErrorMessage(name, info);
                    console.error(str);

                    if (isNotFound(info.error)) {
                        deferred.resolve({
                            name: name,
                            versions: []
                        });
                        return;
                    }

                    deferred.reject(str);
                    return;
                }
                log('extracting versions');
                var versions = extractVersions(info);
                log('versions', versions);

                if (!Array.isArray(versions)) {
                    throw new Error('Could not get versions for ' + name +
                        ' from ' + JSON.stringify(info) +
                        ' response ' + JSON.stringify(response, null, 2));
                }

                var validVersions = versions.filter(cleanVersionForName);
                var newerVersions = validVersions.filter(isLaterVersion);
                log('valid versions', validVersions);
                log('newer versions', newerVersions);

                deferred.resolve({
                    name: name,
                    versions: newerVersions
                });
                return;
            } catch (err) {
                console.error(err);
                deferred.reject('Could not fetch versions for ' + name);
                return;
            }
        }
    });

    return deferred.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.isUrl" id="apidoc.element.next-update.registry.isUrl">
        function <span class="apidocSignatureSpan">next-update.registry.</span>isUrl
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isUrl(str) {
  la(check.string(str), 'expected a string');
  return httpTester.test(str) || gitTester.test(str);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.nextVersions" id="apidoc.element.next-update.registry.nextVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>nextVersions
        <span class="apidocSignatureSpan">(options, nameVersionPairs, checkLatestOnly)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function nextVersions(options, nameVersionPairs, checkLatestOnly) {
    check.verify.object(options, 'expected object with options');
    check.verify.array(nameVersionPairs, 'expected array');
    checkLatestOnly = !!checkLatestOnly;
    nameVersionPairs = cleanVersions(nameVersionPairs);

    var MAX_CHECK_TIMEOUT = 10000;

    if (!options.tldr) {
        console.log('checking NPM registry');
    }
    var fetchPromises = nameVersionPairs.map(fetchVersions);
    var fetchAllPromise = q.all(fetchPromises)
        .timeout(MAX_CHECK_TIMEOUT, 'timed out waiting for NPM');

    return fetchAllPromise.then(function (results) {
        check.verify.array(results, 'expected list of results');
        log('fetch all new version results');
        log(results);

        var available = results.filter(function (nameNewVersions) {
            return nameNewVersions &amp;&amp;
                check.array(nameNewVersions.versions) &amp;&amp;
                nameNewVersions.versions.length;
        });
        if (checkLatestOnly) {
            available = available.map(function (nameVersions) {
                if (nameVersions.versions.length &gt; 1) {
                    nameVersions.versions = nameVersions.versions.slice(-1);
                }
                return nameVersions;
            });
        } else {
            console.log('checking ALL versions');
        }
        return available;
    }, function (error) {
        return q.reject(error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.report" id="apidoc.module.next-update.report">module next-update.report</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.report.report" id="apidoc.element.next-update.report.report">
        function <span class="apidocSignatureSpan">next-update.</span>report
        <span class="apidocSignatureSpan">(updates, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function report(updates, options) {
    options = options || {};
    var useColors = Boolean(options.useColors) &amp;&amp; colorAvailable;
    check.verify.array(updates, 'expected array of updates');
    // sets latest working version for each module too
    var cmd = formInstallCommand(updates);

    console.log('\n&gt; next updates:');
    updates.forEach(function (moduleVersions) {
        reportModule(moduleVersions, useColors);
    });

    var reportChanges = updates.map(function (moduleVersions) {
        return _.partial(printChangedLog, moduleVersions, useColors);
    });

    function printInstallCommand() {
        if (_.isUndefined(cmd)) {
            console.log('&gt; nothing can be updated :(');
        } else {
            if (options.keptUpdates) {
                console.log('&gt; kept working updates');
            } else {
                cmd = cmd.trim();
                var lines = cmd.split('\n').length;
                if (lines === 1) {
                    console.log('&gt; use the following command to install working versions');
                } else {
                    console.log('&gt; use the following commands to install working versions');
                }
                console.log(cmd);
            }
        }
    }

    function printError(err) {
        console.error('Error reporting changes');
        console.error(err.message);
    }
    var start = options.changedLog ?
        reportChanges.reduce(Q.when, Q()).catch(printError) :
        Q();
    return start.then(printInstallCommand);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.report.reportFailure" id="apidoc.element.next-update.report.reportFailure">
        function <span class="apidocSignatureSpan">next-update.report.</span>reportFailure
        <span class="apidocSignatureSpan">(text, useColors)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reportFailure(text, useColors) {
    if (colorAvailable &amp;&amp; useColors) {
        console.log(colors.redBright(text));
    } else {
        console.log('FAIL', text);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.report.reportSuccess" id="apidoc.element.next-update.report.reportSuccess">
        function <span class="apidocSignatureSpan">next-update.report.</span>reportSuccess
        <span class="apidocSignatureSpan">(text, useColors)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reportSuccess(text, useColors) {
    if (colorAvailable &amp;&amp; useColors) {
        console.log(colors.greenBright(text));
    } else {
        console.log('PASS', text);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.stats" id="apidoc.module.next-update.stats">module next-update.stats</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.stats.colorProbability" id="apidoc.element.next-update.stats.colorProbability">
        function <span class="apidocSignatureSpan">next-update.stats.</span>colorProbability
        <span class="apidocSignatureSpan">(probability, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function colorProbability(probability, options) {
    if (probability === null) {
        return '';
    }

    options = options || {};
    var useColors = !!options.color &amp;&amp; colorAvailable;
    if (probability &lt; 0 || probability &gt; 1) {
        throw new Error('Expected probability between 0 and 1, not ' + probability);
    }
    var probabilityStr = (probability * 100).toFixed(0) + '%';
    if (useColors) {
        if (probability &gt; 0.8) {
            probabilityStr = colors.greenBright(probabilityStr);
        } else if (probability &gt; 0.5) {
            probabilityStr = colors.yellowBright(probabilityStr);
        } else {
            probabilityStr = colors.redBright(probabilityStr);
        }
    }
    return probabilityStr;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.getSuccessStats" id="apidoc.element.next-update.stats.getSuccessStats">
        function <span class="apidocSignatureSpan">next-update.stats.</span>getSuccessStats
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getSuccessStats(options) {
    verify.unemptyString(options.name, 'missing name');
    verify.unemptyString(options.from, 'missing from version');
    verify.unemptyString(options.to, 'missing to version');

    verify.webUrl(nextUpdateStatsUrl, 'missing next update stats server url');
    var opts = {
        uri: nextUpdateStatsUrl + '/package/' + options.name + '/' + options.from +
            '/' + options.to,
        method: 'GET',
        json: options
    };
    var defer = Q.defer();
    request(opts, function (err, response, stats) {
        if (err || response.statusCode !== 200) {
            if (response) {
                if (response.statusCode !== 404) {
                    console.error('could not get success stats for', options.name);
                    console.error(opts);
                }
                console.error('response status:', response.statusCode);
            }
            if (err) {
                console.error(err);
            }
            defer.reject(err);
            return;
        }
        defer.resolve(stats);
    });
    return defer.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
};

var test = testPromise(options, options.command);
console.assert(test, 'could not get test promise for command', options.command);

var deferred = q.defer();

var getSuccess = stats.<span class="apidocCodeKeywordSpan">getSuccessStats</span>({
    name: options.name,
    from: options.currentVersion,
    to: options.version
});

getSuccess
    .then(stats.printStats.bind(null, options), function () {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.printStats" id="apidoc.element.next-update.stats.printStats">
        function <span class="apidocSignatureSpan">next-update.stats.</span>printStats
        <span class="apidocSignatureSpan">(options, stats)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function printStats(options, stats) {
    verify.object(stats, 'missing stats object');
    verify.unemptyString(stats.name, 'missing name');
    verify.unemptyString(stats.from, 'missing from version');
    verify.unemptyString(stats.to, 'missing to version');
    stats.success = +stats.success || 0;
    stats.failure = +stats.failure || 0;
    var total = stats.success + stats.failure;
    var probability = (total &gt; 0 ? stats.success / total: 0);
    var probabilityStr = colorProbability(probability, options);
    console.log('stats:', stats.name, stats.from, '-&gt;', stats.to,
        'success probability', probabilityStr,
        stats.success, 'success(es)', stats.failure, 'failure(s)');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.sendUpdateResult" id="apidoc.element.next-update.stats.sendUpdateResult">
        function <span class="apidocSignatureSpan">next-update.stats.</span>sendUpdateResult
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function sendUpdateResult(options) {
    verify.unemptyString(options.name, 'missing name');
    verify.unemptyString(options.from, 'missing from version');
    verify.unemptyString(options.to, 'missing to version');
    if (options.success) {
        options.success = !!options.success;
    }

    verify.webUrl(nextUpdateStatsUrl, 'missing next update stats server url');
    var sendOptions = {
        uri: nextUpdateStatsUrl + '/update',
        method: 'POST',
        json: options
    };
    request(sendOptions, function ignoreResponse() {});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    tldr: options.tldr
});
        })
        .then(test)
        .then(function () {
reportSuccess(nameVersion + ' works', options.color);

stats.<span class="apidocCodeKeywordSpan">sendUpdateResult</span>({
    name: options.name,
    from: options.currentVersion,
    to: options.version,
    success: true
});
results.push(result);
deferred.resolve(results);
...</pre></li>
    </ul>




</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>