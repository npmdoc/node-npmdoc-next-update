<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/bahmutov/next-update"

    >next-update (v1.5.1)</a>
</h1>
<h4>Tests if module's dependencies can be updated to the newer version without breaking the tests</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update">module next-update</a><ol>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>next_update</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>registry</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>report</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">next-update.</span>stats</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.next_update">module next-update.next_update</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.available">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>available
            <span class="apidocSignatureSpan">(moduleName, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.checkAllUpdates">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>checkAllUpdates
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.next_update.checkCurrentInstall">
            function <span class="apidocSignatureSpan">next-update.next_update.</span>checkCurrentInstall
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.registry">module next-update.registry</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.cleanVersion">
            function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersion
            <span class="apidocSignatureSpan">(version, name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.cleanVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersions
            <span class="apidocSignatureSpan">(nameVersionPairs)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.fetchVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>fetchVersions
            <span class="apidocSignatureSpan">(nameVersion)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.isUrl">
            function <span class="apidocSignatureSpan">next-update.registry.</span>isUrl
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.registry.nextVersions">
            function <span class="apidocSignatureSpan">next-update.registry.</span>nextVersions
            <span class="apidocSignatureSpan">(options, nameVersionPairs, checkLatestOnly)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.report">module next-update.report</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.report">
            function <span class="apidocSignatureSpan">next-update.</span>report
            <span class="apidocSignatureSpan">(updates, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.reportFailure">
            function <span class="apidocSignatureSpan">next-update.report.</span>reportFailure
            <span class="apidocSignatureSpan">(text, useColors)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.report.reportSuccess">
            function <span class="apidocSignatureSpan">next-update.report.</span>reportSuccess
            <span class="apidocSignatureSpan">(text, useColors)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.next-update.stats">module next-update.stats</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.colorProbability">
            function <span class="apidocSignatureSpan">next-update.stats.</span>colorProbability
            <span class="apidocSignatureSpan">(probability, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.getSuccessStats">
            function <span class="apidocSignatureSpan">next-update.stats.</span>getSuccessStats
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.printStats">
            function <span class="apidocSignatureSpan">next-update.stats.</span>printStats
            <span class="apidocSignatureSpan">(options, stats)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.next-update.stats.sendUpdateResult">
            function <span class="apidocSignatureSpan">next-update.stats.</span>sendUpdateResult
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">next-update.stats.</span>url</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update" id="apidoc.module.next-update">module next-update</a></h1>









</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.next_update" id="apidoc.module.next-update.next_update">module next-update.next_update</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.next_update.available" id="apidoc.element.next-update.next_update.available">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>available
        <span class="apidocSignatureSpan">(moduleName, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function available(moduleName, options) {
    options = options || {};
    var toCheck = getDependenciesToCheck(options, moduleName);
    la(check.array(toCheck), &#x27;expected object of deps to check, was&#x27;, toCheck);
    var toCheckHash = _.zipObject(
        _.pluck(toCheck, &#x27;name&#x27;),
        _.pluck(toCheck, &#x27;version&#x27;)
    );

    log(&#x27;need to check these dependencies&#x27;);
    log(toCheckHash);

    var nextVersionsPromise = nextVersions(options, toCheck);
    return nextVersionsPromise.then(function (info) {
        return reportAvailable(info, toCheckHash, options);
    }, function (error) {
        console.error(&#x27;Could not fetch available modules\n&#x27;, error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.next_update.checkAllUpdates" id="apidoc.element.next-update.next_update.checkAllUpdates">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>checkAllUpdates
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkAllUpdates(options) {
    options = options || {};
    var moduleName = options.names;
    var checkLatestOnly = !!options.latest;
    var checkCommand = options.testCommand;
    if (checkCommand) {
        verify.unemptyString(checkCommand, &#x27;invalid test command &#x27; + checkCommand);
    }
    var all = options.all;
    if (all) {
        checkLatestOnly = true;
        console.log(&#x27;will check only latest versions because testing all&#x27;);
    }

    if (check.string(moduleName)) {
        moduleName = [moduleName];
    }
    checkLatestOnly = !!checkLatestOnly;
    if (checkCommand) {
        check.verify.string(checkCommand, &#x27;expected string test command&#x27;);
    }
    var toCheck = getDependenciesToCheck(options, moduleName);
    check.verify.array(toCheck, &#x27;dependencies to check should be an array&#x27;);

    makeSureValidModule(moduleName, toCheck);

    var testVersionsBound = testVersions.bind(null, {
        modules: toCheck,
        command: checkCommand,
        all: all,
        color: options.color,
        keep: options.keep,
        allowed: options.allow || options.allowed,
        tldr: options.tldr,
        type: options.type
    });

    return isOnline()
        .then(function (online) {
            if (!online) {
                throw new Error(&#x27;Need to be online to check new modules&#x27;);
            }
        }).then(function () {
            if (isSingleSpecificVersion(moduleName)) {
                var nv = nameVersionParser(moduleName[0]);
                console.log(&#x27;checking only specific:&#x27;, nv.name, nv.version);
                var list = [{
                    name: nv.name,
                    versions: [nv.version]
                }];
                return testVersionsBound(list);
            } else {
                var nextVersionsPromise = nextVersions(options, toCheck, checkLatestOnly);
                return nextVersionsPromise.then(testVersionsBound);
            }
        });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.next_update.checkCurrentInstall" id="apidoc.element.next-update.next_update.checkCurrentInstall">
        function <span class="apidocSignatureSpan">next-update.next_update.</span>checkCurrentInstall
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkCurrentInstall(options) {
    options = options || {};
    var log = options.tldr ? _.noop : boundConsoleLog;
    log(&#x27;checking if the current state works&#x27;);

    return cleanDependencies()
        .then(checkDependenciesInstalled)
        .then(function () {
            return runTest(options, options.testCommand)();
        })
        .then(function () {
            console.log(&#x27;&#x3e; tests are passing at the start&#x27;);
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.registry" id="apidoc.module.next-update.registry">module next-update.registry</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.registry.cleanVersion" id="apidoc.element.next-update.registry.cleanVersion">
        function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersion
        <span class="apidocSignatureSpan">(version, name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cleanVersion(version, name) {
    var originalVersion = version;
    verify.unemptyString(version, &#x27;missing version string&#x27; + version);
    verify.unemptyString(name, &#x27;missing name string&#x27; + name);

    if (isUrl(version)) {
        // version = version.substr(version.indexOf(&#x27;#&#x27;) + 1);

        // hmm, because we don&#x27;t have a way to fetch git tags yet
        // just skip these dependencies
        console.log(&#x27;Cannot handle git repos, skipping&#x27;, name, &#x27;at&#x27;, version);
        return;
    }
    if (version === &#x27;original&#x27; ||
        version === &#x27;modified&#x27; ||
        version === &#x27;created&#x27;) {
        return;
    }

    version = version.replace(&#x27;~&#x27;, &#x27;&#x27;).replace(&#x27;^&#x27;, &#x27;&#x27;);
    var twoDigitVersion = /^\d+\.\d+$/;
    if (twoDigitVersion.test(version)) {
        version += &#x27;.0&#x27;;
    }
    if (version === &#x27;latest&#x27; || version === &#x27;*&#x27;) {
        console.log(&#x27;Module&#x27;, name, &#x27;uses version&#x27;, version);
        console.log(&#x27;It is recommented to list a specific version number&#x27;);
        version = localVersion(name);
        if (!version) {
            version = &#x27;0.0.1&#x27;;
        }
        console.log(&#x27;module&#x27;, name, &#x27;local version&#x27;, version);
    }
    try {
        version = semver.clean(version);
    } catch (err) {
        console.error(&#x27;exception when cleaning version&#x27;, version);
        return;
    }
    if (!version) {
        log(&#x27;could not clean version &#x27; + originalVersion + &#x27; for &#x27; + name);
        return;
    }
    console.assert(version, &#x27;missing clean version &#x27; + originalVersion + &#x27; for &#x27; + name);
    return version;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.cleanVersions" id="apidoc.element.next-update.registry.cleanVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>cleanVersions
        <span class="apidocSignatureSpan">(nameVersionPairs)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cleanVersions(nameVersionPairs) {
    check.verify.array(nameVersionPairs, &#x27;expected array&#x27;);
    var cleaned = nameVersionPairs
        .map(cleanVersionObject)
        .filter(check.object);
    return cleaned;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.fetchVersions" id="apidoc.element.next-update.registry.fetchVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>fetchVersions
        <span class="apidocSignatureSpan">(nameVersion)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function fetchVersions(nameVersion) {
    // console.log(nameVersion);
    // TODO use check.schema
    check.verify.object(nameVersion, &#x27;expected name, version object&#x27;);
    var name = nameVersion.name;
    var version = nameVersion.version;
    check.verify.string(name, &#x27;missing name string&#x27;);
    check.verify.string(version, &#x27;missing version string&#x27;);

    var cleanVersionForName = _.partial(cleanVersionFor, name);
    function isLaterVersion(ver) {
        var later = semver.gt(ver, version);
        return later;
    }

    // console.log(&#x27;fetching versions for&#x27;, name, &#x27;current version&#x27;, version);
    var MAX_WAIT_TIMEOUT = 25000;
    var deferred = q.defer();

    function rejectOnTimeout() {
        var msg = &#x27;timed out waiting for NPM for package &#x27; + name +
            &#x27; after &#x27; + MAX_WAIT_TIMEOUT + &#x27;ms&#x27;;
        console.error(msg);
        deferred.reject(msg);
    }

    function escapeName(str) {
        return str.replace(&#x27;/&#x27;, &#x27;%2F&#x27;);
    }

    registryUrl().then(function (npmUrl) {
        log(&#x27;NPM registry url&#x27;, npmUrl);
        la(check.webUrl(npmUrl), &#x27;need npm registry url, got&#x27;, npmUrl);

        npmUrl = npmUrl.replace(/^https:/, &#x27;http:&#x27;).trim();
        var url = npmUrl + escapeName(name);

        // TODO how to detect if the registry is not responding?

        log(&#x27;getting url&#x27;, url);
        request.get(url, onNPMversions);
        var timer = setTimeout(rejectOnTimeout, MAX_WAIT_TIMEOUT);

        function onNPMversions(err, response, body) {
            log(&#x27;got response for&#x27;, url);
            clearTimeout(timer);

            if (err) {
                console.error(&#x27;ERROR when fetching info for package&#x27;, name);
                deferred.reject(err.message);
                return;
            }

            if (is404(response)) {
                log(&#x27;404 response for&#x27;, url);
                deferred.resolve({
                    name: name,
                    versions: []
                });
                return;
            }

            try {
                log(&#x27;parsing response body&#x27;);
                var info = JSON.parse(body);
                log(&#x27;parsed response, error?&#x27;, info.error);
                if (info.error) {
                    log(&#x27;error parsing\n&#x27; + body + &#x27;\n&#x27;);
                    var str = formNpmErrorMessage(name, info);
                    console.error(str);

                    if (isNotFound(info.error)) {
                        deferred.resolve({
                            name: name,
                            versions: []
                        });
                        return;
                    }

                    deferred.reject(str);
                    return;
                }
                log(&#x27;extracting versions&#x27;);
                var versions = extractVersions(info);
                log(&#x27;versions&#x27;, versions);

                if (!Array.isArray(versions)) {
                    throw new Error(&#x27;Could not get versions for &#x27; + name +
                        &#x27; from &#x27; + JSON.stringify(info) +
                        &#x27; response &#x27; + JSON.stringify(response, null, 2));
                }

                var validVersions = versions.filter(cleanVersionForName);
                var newerVersions = validVersions.filter(isLaterVersion);
                log(&#x27;valid versions&#x27;, validVersions);
                log(&#x27;newer versions&#x27;, newerVersions);

                deferred.resolve({
                    name: name,
                    versions: newerVersions
                });
                return;
            } catch (err) {
                console.error(err);
                deferred.reject(&#x27;Could not fetch versions for &#x27; + name);
                return;
            }
        }
    });

    return deferred.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.isUrl" id="apidoc.element.next-update.registry.isUrl">
        function <span class="apidocSignatureSpan">next-update.registry.</span>isUrl
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isUrl(str) {
  la(check.string(str), &#x27;expected a string&#x27;);
  return httpTester.test(str) || gitTester.test(str);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.registry.nextVersions" id="apidoc.element.next-update.registry.nextVersions">
        function <span class="apidocSignatureSpan">next-update.registry.</span>nextVersions
        <span class="apidocSignatureSpan">(options, nameVersionPairs, checkLatestOnly)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function nextVersions(options, nameVersionPairs, checkLatestOnly) {
    check.verify.object(options, &#x27;expected object with options&#x27;);
    check.verify.array(nameVersionPairs, &#x27;expected array&#x27;);
    checkLatestOnly = !!checkLatestOnly;
    nameVersionPairs = cleanVersions(nameVersionPairs);

    var MAX_CHECK_TIMEOUT = 10000;

    if (!options.tldr) {
        console.log(&#x27;checking NPM registry&#x27;);
    }
    var fetchPromises = nameVersionPairs.map(fetchVersions);
    var fetchAllPromise = q.all(fetchPromises)
        .timeout(MAX_CHECK_TIMEOUT, &#x27;timed out waiting for NPM&#x27;);

    return fetchAllPromise.then(function (results) {
        check.verify.array(results, &#x27;expected list of results&#x27;);
        log(&#x27;fetch all new version results&#x27;);
        log(results);

        var available = results.filter(function (nameNewVersions) {
            return nameNewVersions &#x26;&#x26;
                check.array(nameNewVersions.versions) &#x26;&#x26;
                nameNewVersions.versions.length;
        });
        if (checkLatestOnly) {
            available = available.map(function (nameVersions) {
                if (nameVersions.versions.length &#x3e; 1) {
                    nameVersions.versions = nameVersions.versions.slice(-1);
                }
                return nameVersions;
            });
        } else {
            console.log(&#x27;checking ALL versions&#x27;);
        }
        return available;
    }, function (error) {
        return q.reject(error);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.report" id="apidoc.module.next-update.report">module next-update.report</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.report.report" id="apidoc.element.next-update.report.report">
        function <span class="apidocSignatureSpan">next-update.</span>report
        <span class="apidocSignatureSpan">(updates, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function report(updates, options) {
    options = options || {};
    var useColors = Boolean(options.useColors) &#x26;&#x26; colorAvailable;
    check.verify.array(updates, &#x27;expected array of updates&#x27;);
    // sets latest working version for each module too
    var cmd = formInstallCommand(updates);

    console.log(&#x27;\n&#x3e; next updates:&#x27;);
    updates.forEach(function (moduleVersions) {
        reportModule(moduleVersions, useColors);
    });

    var reportChanges = updates.map(function (moduleVersions) {
        return _.partial(printChangedLog, moduleVersions, useColors);
    });

    function printInstallCommand() {
        if (_.isUndefined(cmd)) {
            console.log(&#x27;&#x3e; nothing can be updated :(&#x27;);
        } else {
            if (options.keptUpdates) {
                console.log(&#x27;&#x3e; kept working updates&#x27;);
            } else {
                cmd = cmd.trim();
                var lines = cmd.split(&#x27;\n&#x27;).length;
                if (lines === 1) {
                    console.log(&#x27;&#x3e; use the following command to install working versions&#x27;);
                } else {
                    console.log(&#x27;&#x3e; use the following commands to install working versions&#x27;);
                }
                console.log(cmd);
            }
        }
    }

    function printError(err) {
        console.error(&#x27;Error reporting changes&#x27;);
        console.error(err.message);
    }
    var start = options.changedLog ?
        reportChanges.reduce(Q.when, Q()).catch(printError) :
        Q();
    return start.then(printInstallCommand);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.report.reportFailure" id="apidoc.element.next-update.report.reportFailure">
        function <span class="apidocSignatureSpan">next-update.report.</span>reportFailure
        <span class="apidocSignatureSpan">(text, useColors)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reportFailure(text, useColors) {
    if (colorAvailable &#x26;&#x26; useColors) {
        console.log(colors.redBright(text));
    } else {
        console.log(&#x27;FAIL&#x27;, text);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.report.reportSuccess" id="apidoc.element.next-update.report.reportSuccess">
        function <span class="apidocSignatureSpan">next-update.report.</span>reportSuccess
        <span class="apidocSignatureSpan">(text, useColors)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reportSuccess(text, useColors) {
    if (colorAvailable &#x26;&#x26; useColors) {
        console.log(colors.greenBright(text));
    } else {
        console.log(&#x27;PASS&#x27;, text);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.next-update.stats" id="apidoc.module.next-update.stats">module next-update.stats</a></h1>


    <h2>
        <a href="#apidoc.element.next-update.stats.colorProbability" id="apidoc.element.next-update.stats.colorProbability">
        function <span class="apidocSignatureSpan">next-update.stats.</span>colorProbability
        <span class="apidocSignatureSpan">(probability, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function colorProbability(probability, options) {
    if (probability === null) {
        return &#x27;&#x27;;
    }

    options = options || {};
    var useColors = !!options.color &#x26;&#x26; colorAvailable;
    if (probability &#x3c; 0 || probability &#x3e; 1) {
        throw new Error(&#x27;Expected probability between 0 and 1, not &#x27; + probability);
    }
    var probabilityStr = (probability * 100).toFixed(0) + &#x27;%&#x27;;
    if (useColors) {
        if (probability &#x3e; 0.8) {
            probabilityStr = colors.greenBright(probabilityStr);
        } else if (probability &#x3e; 0.5) {
            probabilityStr = colors.yellowBright(probabilityStr);
        } else {
            probabilityStr = colors.redBright(probabilityStr);
        }
    }
    return probabilityStr;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.getSuccessStats" id="apidoc.element.next-update.stats.getSuccessStats">
        function <span class="apidocSignatureSpan">next-update.stats.</span>getSuccessStats
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getSuccessStats(options) {
    verify.unemptyString(options.name, &#x27;missing name&#x27;);
    verify.unemptyString(options.from, &#x27;missing from version&#x27;);
    verify.unemptyString(options.to, &#x27;missing to version&#x27;);

    verify.webUrl(nextUpdateStatsUrl, &#x27;missing next update stats server url&#x27;);
    var opts = {
        uri: nextUpdateStatsUrl + &#x27;/package/&#x27; + options.name + &#x27;/&#x27; + options.from +
            &#x27;/&#x27; + options.to,
        method: &#x27;GET&#x27;,
        json: options
    };
    var defer = Q.defer();
    request(opts, function (err, response, stats) {
        if (err || response.statusCode !== 200) {
            if (response) {
                if (response.statusCode !== 404) {
                    console.error(&#x27;could not get success stats for&#x27;, options.name);
                    console.error(opts);
                }
                console.error(&#x27;response status:&#x27;, response.statusCode);
            }
            if (err) {
                console.error(err);
            }
            defer.reject(err);
            return;
        }
        defer.resolve(stats);
    });
    return defer.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.printStats" id="apidoc.element.next-update.stats.printStats">
        function <span class="apidocSignatureSpan">next-update.stats.</span>printStats
        <span class="apidocSignatureSpan">(options, stats)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function printStats(options, stats) {
    verify.object(stats, &#x27;missing stats object&#x27;);
    verify.unemptyString(stats.name, &#x27;missing name&#x27;);
    verify.unemptyString(stats.from, &#x27;missing from version&#x27;);
    verify.unemptyString(stats.to, &#x27;missing to version&#x27;);
    stats.success = +stats.success || 0;
    stats.failure = +stats.failure || 0;
    var total = stats.success + stats.failure;
    var probability = (total &#x3e; 0 ? stats.success / total: 0);
    var probabilityStr = colorProbability(probability, options);
    console.log(&#x27;stats:&#x27;, stats.name, stats.from, &#x27;-&#x3e;&#x27;, stats.to,
        &#x27;success probability&#x27;, probabilityStr,
        stats.success, &#x27;success(es)&#x27;, stats.failure, &#x27;failure(s)&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.next-update.stats.sendUpdateResult" id="apidoc.element.next-update.stats.sendUpdateResult">
        function <span class="apidocSignatureSpan">next-update.stats.</span>sendUpdateResult
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function sendUpdateResult(options) {
    verify.unemptyString(options.name, &#x27;missing name&#x27;);
    verify.unemptyString(options.from, &#x27;missing from version&#x27;);
    verify.unemptyString(options.to, &#x27;missing to version&#x27;);
    if (options.success) {
        options.success = !!options.success;
    }

    verify.webUrl(nextUpdateStatsUrl, &#x27;missing next update stats server url&#x27;);
    var sendOptions = {
        uri: nextUpdateStatsUrl + &#x27;/update&#x27;,
        method: &#x27;POST&#x27;,
        json: options
    };
    request(sendOptions, function ignoreResponse() {});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
